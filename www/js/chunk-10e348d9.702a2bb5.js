(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-10e348d9"],{"09b9":function(e,t,s){e.exports=s.p+"www/img/back_img.d7b20175.png"},"775b":function(e,t,s){},b461:function(e,t,s){"use strict";s.r(t);var o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"login",style:e.loginStyle},[s("div",{staticClass:"loginHeader"}),s("div",{staticClass:"loginTitle",on:{click:e.loginTextClicked}},[e._v("登录")]),0===e.loginType?s("div",{staticClass:"loginArea"},[s("div",{staticClass:"phoneArea"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.phoneNum,expression:"phoneNum"}],staticClass:"phoneInput",attrs:{onkeyup:"value=value.replace(/[^\\d]/g,'')",maxlength:"11",type:"text",placeholder:"手机号"},domProps:{value:e.phoneNum},on:{input:function(t){t.target.composing||(e.phoneNum=t.target.value)}}})]),s("div",{staticClass:"checkArea"},[s("div",{staticClass:"check_code_div"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.phoneCode,expression:"phoneCode"}],staticClass:"checkInput",attrs:{type:"text",placeholder:"验证码"},domProps:{value:e.phoneCode},on:{input:function(t){t.target.composing||(e.phoneCode=t.target.value)}}}),s("div",{staticClass:"checkButton",on:{click:function(t){return e.sendPhoneCode(t)}}},[e._v("  "+e._s(e.verifyCodeStr)+"  ")])])])]):1==e.loginType?s("div",{staticClass:"loginArea"},[s("div",{staticClass:"phoneArea"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.phoneNum,expression:"phoneNum"}],staticClass:"phoneInput",attrs:{onkeyup:"value=value.replace(/[^\\d]/g,'')",maxlength:"11",type:"text",placeholder:"账号"},domProps:{value:e.phoneNum},on:{input:function(t){t.target.composing||(e.phoneNum=t.target.value)}}})]),s("div",{staticClass:"checkArea"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.passWd,expression:"passWd"}],staticClass:"phoneInput",attrs:{type:"password",placeholder:"密码"},domProps:{value:e.passWd},on:{input:function(t){t.target.composing||(e.passWd=t.target.value)}}})])]):e._e(),s("div",{staticClass:"loginBut",attrs:{plain:""},on:{click:e.login}},[e._v("登录")]),s("div",{staticClass:"loginButton"},[s("div",{staticClass:"changLoign",staticStyle:{float:"left"},on:{click:e.updateCount}},[e._v("切换登录方式")]),s("div",{staticClass:"changLoign",staticStyle:{float:"right"},on:{click:e.switchNewPasswd}},[e._v("忘记密码")])]),s("van-action-sheet",{attrs:{round:!0,"safe-area-inset-bottom":!0,actions:e.envSwitchActions,"cancel-text":"取消"},on:{select:e.onSelect,cancel:e.onCancel},model:{value:e.isShowenvSwitch,callback:function(t){e.isShowenvSwitch=t},expression:"isShowenvSwitch"}})],1)},i=[],n=(s("a481"),s("d28e")),a=s("da6f"),c=s("371c"),h=s("d915"),l=s("2b0e"),r=s("2241"),u=s("d399"),d=s("a49b");l["default"].use(r["a"],u["a"]);var g={name:"Login",data:function(){return{debug:!1,loginType:1,phoneNum:"",passWd:"",phoneCode:"",timeStart:0,timeVerify:0,clockID:"",id:"0",verifyCodeStr:"发送验证码",back:s("09b9"),loginStyle:{backgroundImage:"url("+s("09b9")+")",backgroundSize:"cover",backgroundRepeat:"no-repeat"},isShowenvSwitch:!1,envSelectIndex:"666",envSwitchActions:[],versonClickCount:0,publicKey:"",rsaPassWord:""}},methods:{updateCount:function(){this.loginType=1-this.loginType,this.phoneCode="",this.passWd=""},checkUserData:function(){this.getPubKey(!1),this.resetData();var e=a["a"].getStorage("custNews");null===e||e.$s_code_$exp||"数据不存在"===e.message||"数据已过期"===e.message?c["a"].i("Not login or login timeout, should login first."+JSON.stringify(e)):(Object(n["m"])(e),this.updateUserInfo(e),Object(n["k"])(e),a["b"].set("currentTabIndex",0),this.$router.replace({path:"home"}))},updateUserInfo:function(e){var t={AREA_CODE:e.AREA_CODE,USER_CODE:e.USER_CODE};Object(h["d"])(t).then((function(t){var s=t.PIC_URL;""!=s&&(e.PIC_URL=s),e.USER_ACCNT=t.USER_ACCNT,e.USER_NICK_NAME=t.USER_NICK_NAME,e.PHONE=t.PHONE,Object(n["m"])(e)})).catch((function(e){c["a"].e(e)}))},login:function(){var e=this;if(!this.publicKey)return console.log("key "+JSON.stringify(this.publicKey)),void this.getPubKey(!0);if(1===this.loginType){if(void 0===this.phoneNum||""===this.phoneNum)return void this.showMsg("账号不能为空");if(!/^(((11[0-9]{1})|(12[0-9]{1})|(13[0-9]{1})|(14[0-9]{1})|(15[0-9]{1})|(16[0-9]{1})|(17[0-9]{1})|(18[0-9]{1})|(19[0-9]{1}))+\d{8})$/.test(this.phoneNum))return void this.showMsg("请输入正确的手机号");if(void 0===this.passWd||""===this.passWd)return void this.showMsg("密码不能为空");var t=btoa(this.passWd);console.log(t);var s=this.phoneNum+","+t+",10";this.rsaPassWord=this.$getRSASign(s,this.publicKey),c["a"].i(this.rsaPassWord);var o=this.rsaPassWord;Object(n["h"])(o).then((function(t){e.loginSuccess(t)})).catch((function(t){e.loginFailed(t)}))}else if(0===this.loginType){if(void 0===this.phoneNum||""===this.phoneNum)return void this.showMsg("手机号不能为空");if(!/^(((11[0-9]{1})|(12[0-9]{1})|(13[0-9]{1})|(14[0-9]{1})|(15[0-9]{1})|(16[0-9]{1})|(17[0-9]{1})|(18[0-9]{1})|(19[0-9]{1}))+\d{8})$/.test(this.phoneNum))return void this.showMsg("请输入正确的手机号");if(void 0===this.phoneCode||""===this.phoneCode)return void this.showMsg("请输入验证码");this.timeVerify=Object(n["e"])();var i=this.phoneNum+","+this.phoneCode+",10";this.rsaPassWord=this.$getRSASign(i,this.publicKey);var a=this.rsaPassWord;Object(n["i"])(a).then((function(t){e.loginSuccess(t)})).catch((function(t){e.loginFailed(t)}))}},sendPhoneCode:function(e){var t=this;if(void 0!==this.phoneNum&&""!==this.phoneNum)if(/^(((11[0-9]{1})|(12[0-9]{1})|(13[0-9]{1})|(14[0-9]{1})|(15[0-9]{1})|(16[0-9]{1})|(17[0-9]{1})|(18[0-9]{1})|(19[0-9]{1}))+\d{8})$/.test(this.phoneNum)){this.phoneNum;if("0"===this.id){this.timeStart=Object(n["e"])();this.phoneNum;if(!this.publicKey)return console.log("key "+JSON.stringify(this.publicKey)),void this.getPubKey(!1,!0);var s=this.phoneNum+",10";this.rsaPhoneInfo=this.$getRSASign(s,this.publicKey),c["a"].i(this.rsaPhoneInfo);var o=this.rsaPhoneInfo;Object(n["f"])(o).then((function(e){if(console.log(JSON.stringify(e)),0==e.resultCode){t.id="1";try{var s=60;t.verifyCodeStr=s+"秒后重发",t.clockID=window.setInterval((function(){s--,s>0&&(t.verifyCodeStr=s+"秒后重发"),s<=0&&(window.clearInterval(t.clockID),t.verifyCodeStr="重发验证码",s=60,t.id="0")}),1e3)}catch(o){t.showMsg(o)}}else t.showMsg(e.msg)})).catch((function(e){console.log("get phone code failed."+e),t.showMsg(e)}))}else this.showMsg("请稍后重试！")}else this.showMsg("请输入正确的手机号");else this.showMsg("手机号不能为空")},showMsg:function(e){this.$toast(e)},loginSuccess:function(e){var t=this;if(c["a"].l(JSON.stringify(e)),c["a"].i(e),"0"==e.resultCode){var s={AREA_CODE:"",AREA_NAME:""};s.EMAIL=e.data.email,s.PHONE=e.data.phone,s.PIC_BG_URL=e.data.picBgUrl,s.PIC_URL=e.data.picUrl,s.TEL=e.data.tel,s.USER_ACCNT=e.data.userAccnt,s.USER_CODE=e.data.userCode,s.USER_NAME=e.data.userName,s.USER_NICK_NAME=e.data.userNickName,s.sales_man_flag=e.data.salesManFlag,s.operation_flag=e.data.operationFlag,s.deptCode=e.data.deptCode,Object(n["m"])(s),a["a"].setStorage("custNews",s,60),console.log(e.data.accessToken),a["a"].setStorage("accessToken",e.data.accessToken,.1),a["a"].setStorage("refreshToken",e.data.refreshToken,30),a["b"].set("accessToken",e.data.accessToken),a["b"].set("refreshToken",e.data.refreshToken),Object(n["k"])(s);var o=e;void 0==o&&(o=""),a["b"].set("currentTabIndex",0),this.loginXtSystem(s,(function(){t.$router.replace({path:"home"})}))}else this.showMsg(e.resultMsg)},loginFailed:function(e){var t=e;"网络异常！"==t?this.showMsg("网络异常，请检查网络！"):this.showMsg("登录失败, "+t),c["a"].e("login failed for "+t)},switchNewPasswd:function(){this.$router.push("/passwdchange")},resetData:function(){this.debug=!1,this.loginType=1,this.phoneNum="",this.passWd="",this.phoneCode="",this.timeStart=0,this.timeVerify=0,this.verifyCodeStr="发送验证码",window.clearInterval(this.clockID),this.clockID="",this.id="0"},loginTextClicked:function(){var e=this;this.versonClickCount++,this.versonClickCount>=10&&(this.versonClickCount=0,r["a"].confirm({message:"是否要修改网络环境？"}).then((function(){for(var t="#07c160",s="#007aff",o=Object.getOwnPropertyNames(d["a"].urlMap),i=a["b"].get("custUrl"),n=[],c={},h=0;h<o.length;h++)c=d["a"].urlMap[o[h]],n.push({name:c.envName,color:i.key===c.key?t:s,index:c.key});e.envSwitchActions=n,e.isShowenvSwitch=!0})).catch((function(){})))},onSelect:function(e){this.isShowenvSwitch=!1,this.envSelectIndex=e.index,this.envChangedCallBack()},onCancel:function(){},envChangedCallBack:function(){var e="";e=d["a"].urlMap[this.envSelectIndex],a["b"].set("custUrl",e),a["a"].setStorage("custUrl",e,365),this.$plugin.usePlugin("Broadcast")("ServiceEnvAdressChange",{appUrl:e.homeUrl}),Object(u["a"])("环境切换成功!")},getPubKey:function(e,t){var s=this;Object(n["g"])().then((function(o){s.publicKey=o.data.publicKey,e&&(console.log("get pub key for login."),s.login()),t&&(console.log("get pub key for phone code."),s.sendPhoneCode())})).catch((function(o){console.log("get pub key failed "+o),e&&(console.log("get pub key for login."+o),"网络异常！"==o?s.showMsg("网络异常，请检查网络！"):s.showMsg("登录失败~")),t&&(console.log("get pub key for phone code."+o),"网络异常！"==o?s.showMsg("网络异常，请检查网络！"):s.showMsg("验证码获取失败~"))}))},loginXtSystem:function(e,t){var s=this,o={roleId:999,userCode:e.USER_CODE,userAccnt:e.USER_ACCNT,phone:e.PHONE,userName:e.USER_NAME,userNickName:e.USER_NICK_NAME};Object(n["d"])(o).then((function(e){if(console.log("获取管控平台token",e),console.log("1213",e),200===e.code){var o=e.data.token;a["a"].setStorage("controlToken",o,999)}else e.message&&s.showMsg(e.message);t&&t()})).catch((function(e){console.log("1213",res),s.showMsg("当前网络不可用"),t&&t()}))}},activated:function(){this.checkUserData()}},p=g,v=(s("d79c"),s("2877")),f=Object(v["a"])(p,o,i,!1,null,"62cc26a8",null);t["default"]=f.exports},d79c:function(e,t,s){"use strict";var o=s("775b"),i=s.n(o);i.a}}]);
//# sourceMappingURL=chunk-10e348d9.702a2bb5.js.map