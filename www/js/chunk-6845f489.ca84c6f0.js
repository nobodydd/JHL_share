(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6845f489"],{"562f":function(t,e,s){},"9ab1":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"success"},[s("navigation-bar",{attrs:{pageName:t.pageName},on:{onLeftClick:t.goBack}}),s("div",{staticClass:"content"},[s("div",{ref:"cardDom",staticClass:"card"},[s("div",{staticClass:"card-content"},[s("div",{staticClass:"text"},[t._v(t._s(t.addStr))]),s("div",{staticClass:"text"},[t._v("有效期 "+t._s(t.queryObj.startTimeStr)+" 至 "+t._s(t.queryObj.endTimeStr))]),s("div",{staticClass:"pic"},[s("div",{directives:[{name:"show",rawName:"v-show",value:0==t.queryObj.face,expression:"queryObj.face==0"}],staticClass:"qr"},[s("canvas",{ref:"QrcodeImg",staticClass:"imgCode"})]),s("div",{staticClass:"map"},[s("div",{staticClass:"img map-img",style:t.getMapStyle,on:{touchstart:function(e){return t.gotouchstart(e)},touchmove:function(e){return t.gotouchmove(e)},touchend:t.gotouchend}}),s("div",{staticClass:"pic-tips"},[t._v("\n                点击放大地图长按保存地图\n              ")])])]),s("div",{staticClass:"info"},[s("div",{staticClass:"item"},[s("div",{staticClass:"title"},[t._v("到访人")]),s("div",{staticClass:"val"},[t._v(t._s(t.queryObj.guest))])]),s("div",{staticClass:"item"},[s("div",{staticClass:"title"},[t._v("是否人脸通行")]),s("div",{staticClass:"val"},[t._v(t._s(1==t.queryObj.face?"是":"否"))])]),s("div",{staticClass:"item"},[s("div",{staticClass:"title"},[t._v("是否有车辆")]),s("div",{staticClass:"val"},[t._v(t._s(t.queryObj.plateNum?"是":"否"))])]),t.queryObj.plateNum?s("div",{staticClass:"item"},[s("div",{staticClass:"title"},[t._v("车牌号")]),s("div",{staticClass:"val"},[t._v(t._s(t.queryObj.plateNum))])]):t._e()]),s("div",{staticClass:"tips"},[t._v("\n            提示：访客可"+t._s(1==t.queryObj.face?"刷脸":"使用二维码")+"进入小区门并乘坐电梯\n          ")])])]),s("div",{staticClass:"btn-area"},[s("button",{staticClass:"btn save-btn",on:{click:t.generatePicture}},[t._v("保存至相册")])])]),s("img",{ref:"mapImgDom",attrs:{src:t.getMapImg,alt:""}}),s("van-image-preview",{attrs:{images:t.images,showIndex:!1},model:{value:t.showImg,callback:function(e){t.showImg=e},expression:"showImg"}})],1)},i=[],o=(s("28a5"),s("bd86")),n=(s("7f7f"),s("1b06")),c=s("28a2"),r=s("da6f"),u=s("d055"),d=s.n(u),l=s("c0e9"),h=s.n(l),v=s("da6a"),g={name:"success",components:Object(o["a"])({NavigationBar:v["a"]},c["a"].name,c["a"]),data:function(){return{pageName:"访客通行码",custNews:"",addArr:[],addStr:"",qrCanvas:"",qrcodeKey:"",queryObj:{},showImg:!1,images:[r["a"].getStorage("xtBaseUrl")+"/map_xq.jpg"],dataURL:"",firstFlag:!0,timeOutEvent:0}},computed:{getMapImg:function(){return this.images[0]},getMapStyle:function(){var t=r["a"].getStorage("xtBaseUrl")+"/map_xq.jpg";return{background:"url("+t+")no-repeat center",backgroundSize:"75%"}}},created:function(){this.queryObj=this.$route.query,this.custNews=r["b"].get("custNews"),this.addArr=this.queryObj.doorNum.split("-"),this.addStr=this.custNews.AREA_NAME+this.addArr[0]+"号楼"+this.addArr[1]+"单元"+this.addArr[2]},mounted:function(){0==this.queryObj.face&&this.getQrcode()},methods:{goBack:function(){this.$router.push({path:"/visitorRegister/record"})},getQrcode:function(){this.qrCanvas=this.$refs.QrcodeImg,this.loading=!0;var t=this,e={areaCode:this.custNews.AREA_CODE,buildCode:this.addArr[0],unitCode:this.addArr[1],roomCode:this.addArr[2],ownerCode:"",ownerName:this.queryObj.guest,phone:this.queryObj.guestPhone,endTime:this.queryObj.endTime,appFaceParkingId:this.queryObj.id};Object(n["k"])(e).then((function(e){t.loading=!1,200==e.code?(t.qrcodeKey=e.data,""!=t.qrcodeKey?d.a.toCanvas(t.qrCanvas,t.qrcodeKey):t.$toast("获取二维码失败")):(console.log("获取二维码"),t.$toast(e.message))})).catch((function(e){t.loading=!1,t.$toast(e)}))},generatePicture:function(){var t=this,e=this.$refs.cardDom,s=e.offsetWidth,a=e.offsetHeight;h()(e,{scale:2,width:s,height:a,useCORS:!0}).then((function(e){t.onDeviceReady(e)}))},onDeviceReady:function(t){var e=this;console.log("打印插件 "+window.canvas2ImagePlugin),window.cordova&&(this.$toast.loading({duration:0,message:"加载中...",forbidClick:!0,loadingType:"spinner"}),window.canvas2ImagePlugin.saveImageDataToLibrary((function(t){e.$toast.clear(),console.log(JSON.stringify(t)),e.$toast("图片保存成功")}),(function(t){e.$toast.clear(),console.log(JSON.stringify(t)),e.$toast("图片保存失败-请检查权限是否打开")}),t))},img2Cnvas:function(){var t=this,e=this.$refs.mapImgDom,s=e.offsetWidth,a=e.offsetHeight;h()(e,{scale:2,width:s,height:a,useCORS:!0,allowTaint:!1}).then((function(e){t.onDeviceReady(e)}))},gotouchstart:function(t){console.log("--tst",t);var e=t.touches[0].clientY;console.log("---touchStart: "+e);var s=this;clearTimeout(this.timeOutEvent),this.timeOutEvent=setTimeout((function(){s.timeOutEvent=0,s.img2Cnvas(),console.log("--gotouchstart--")}),1e3),this.baseClientY=t.touches[0].clientY},gotouchend:function(){clearTimeout(this.timeOutEvent),0!=this.timeOutEvent&&(this.showImg=!0)},gotouchmove:function(t){console.log("---touchMove: "+t.touches[0].clientY);var e=t.touches[0].clientY,s=Math.abs(e-this.baseClientY);console.log("---touchDiff: "+s),s<10||(clearTimeout(this.timeOutEvent),this.timeOutEvent=0)}}},m=g,f=(s("d9c79"),s("2877")),C=Object(f["a"])(m,a,i,!1,null,"93719b10",null);e["default"]=C.exports},d9c79:function(t,e,s){"use strict";var a=s("562f"),i=s.n(a);i.a}}]);
//# sourceMappingURL=chunk-6845f489.ca84c6f0.js.map